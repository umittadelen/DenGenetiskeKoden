<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>RNA Kalkulator</title>
</head>
<body>
    <div id="all">
        <h1>RNA kalkulator</h1>
        <form id="generateForm" class="form">
            <div id="text-input-div" class="input-div">
                <label for="text-input">Skriv inn RNA-sekvens:</label>
                <textarea id="text-input" name="text-input" oninput="ontextchange(event)" placeholder="skriv inn RNA-sekvens (f.eks. uuauuucagaucauuaa)"></textarea>
                <small>Bruk U i stedet for T (f.eks. AUG i stedet for ATG). Kun bokstavene A, U, C, G er gyldige.</small>
            </div>
        </form>
        <div id="result" class="form">
            <h1>RNA-resultat:</h1>
            <p id="output-p"><span id="output-p-span"></span></p>
        </div>
    </div>
    <script>
        let items; // Declare items in a wider scope

        fetch('./data.json')
        .then(response => response.json())
        .then(data => {
            items = data; // Store the JSON data
        })
        .catch(error => console.error('Error loading JSON:', error));

        function ontextchange(event) {
            const outputSpan = document.getElementById('output-p-span');
            // Replace T with U to ensure RNA sequence
            let text = event.target.value.replaceAll(' ', '').toLowerCase().replaceAll('t', 'u');
            // Only allow valid RNA letters
            text = text.replace(/[^aucg]/g, '');
            const chunks = text.match(/.{1,3}/g) || [];

            // Check if the last chunk is less than 3 characters
            if (chunks.length > 0 && chunks[chunks.length - 1].length < 3) {
                outputSpan.innerHTML = `${3 - chunks[chunks.length - 1].length} bokstav(er) mangler for siste kodon`;
                return;
            }

            // Map each chunk to its corresponding value from items
            const translated = chunks.map(chunk => items[chunk] || chunk);
            outputSpan.innerHTML = translated.join(' ');
        }
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5340331733632234" crossorigin="anonymous"></script>
</body>
</html>